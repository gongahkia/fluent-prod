@startuml
title Fluent Architecture Overview - Component Diagram

skinparam componentStyle rectangle

node "User Device" as Client {
  component "Fluent Frontend (Vite/React)" as UI
  component "Auth Context" as AuthCtx
  component "newsService.js" as SvcNewsF
  component "databaseService.js" as SvcDBF
  component "translationService.js (frontend wrappers)" as SvcTransF
  package "Components" as Comps {
    component "NewsFeed"
    component "SavedPosts"
    component "Dictionary"
    component "Flashcards"
    component "WordLearningPopup"
    component "EnhancedCommentSystem"
  }
}

node "Fluent Backend (Express)" as Backend {
  component "/routes/news.js" as routeNews
  component "/routes/translation.js" as routeTrans
  component "/routes/vocabulary.js" as routeVocab
  component "/routes/ai.js" as routeAI

  component "jobs/fetchPostsJob.js (cron)" as job
  component "services/newsService.js" as svcNewsB
  component "services/translationService.js" as svcTransB
  component "services/vocabularyService.js" as svcVocabB
  component "services/storageService.js" as svcStoreB
  component "config/firebase.js (Admin SDK)" as firebaseAdmin
}

cloud "Firebase Project" as Firebase {
  component "Firebase Auth (client SDK)" as Auth
  database "Cloud Firestore" as Firestore
}

' Frontend internal links
UI --> AuthCtx
UI --> Comps
Comps --> SvcNewsF
Comps --> SvcDBF
Comps --> SvcTransF
AuthCtx --> Auth

' Frontend -> Backend
SvcNewsF --> routeNews : /api/news\n/api/news/sources
SvcTransF ..> routeTrans : optional\n/api/translate, /batch, /mixed-content
Comps ..> routeAI : optional\n/api/ai/comment-suggestions
Comps ..> routeVocab : optional\n/api/vocabulary/*

' Backend internals
routeNews --> svcNewsB
routeTrans --> svcTransB
routeVocab --> svcVocabB
routeAI --> Backend : aiService

' Backend scheduled job
job --> svcNewsB
job --> svcTransB
job --> svcStoreB
Backend <--> firebaseAdmin

' Backend <-> Firebase
svcStoreB <--> Firestore

' Frontend <-> Firebase (client SDK)
SvcDBF <--> Firestore
AuthCtx <--> Auth

note right of svcStoreB
  Posts cached in Firestore\n  collection 'news-cache'
end note

note right of SvcDBF
  User data in Firestore\n  users/{uid}/dictionary\n  users/{uid}/flashcards\n  users/{uid}/savedPosts
end note
@enduml
