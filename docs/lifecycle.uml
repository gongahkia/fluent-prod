@startuml
title Reddit Post Lifecycle - From Fetch to Frontend

actor User
actor Cron as "Backend Cron (node-cron)"
participant "Reddit API" as Reddit
participant "Backend Processing" as Proc
database "Firebase Firestore" as Firestore
participant "Backend API (Express)" as API
participant "Frontend (React)" as FE

' Nightly job
Cron -> Reddit: Fetch subreddit JSON\nfor queries (japan/korea)
Reddit --> Cron: Posts (title, selftext, author,\ncreated_utc, subreddit)
Cron -> Proc: normalizeRedditPost()\nstrip markdown to plaintext
Proc -> Proc: calculateEnglishDifficulty()\n-> difficulty 1..5
Proc -> Proc: createMixedLanguageContent()\nfor title/content at assigned level
Proc -> Firestore: uploadPostsToStorage('news-cache/posts-*.json')
Firestore --> Proc: ack

' Frontend load
FE -> API: POST /api/news { query, limit,\nuserLevel, targetLang }
API -> Firestore: downloadPostsFromStorage(file)
Firestore --> API: posts[] (preprocessed)
API --> FE: { posts, metadata }
FE -> FE: render posts in NewsFeed

' User actions
User -> FE: Save Post
FE -> Firestore: users/{uid}/savedPosts/{postId}
Firestore --> FE: ack
User -> FE: Add word to dictionary
FE -> Firestore: users/{uid}/dictionary/{wordId}
Firestore --> FE: ack
FE -> FE: Flashcards consume dictionary;\nexamples cleaned of {{WORD:n}}
@enduml